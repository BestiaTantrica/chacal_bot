# ðŸ“œ PROTOCOLO DE SUPERVIVENCIA "CHACAL" - REGLAS DE ORO

**ESTE DOCUMENTO ES DE LECTURA OBLIGATORIA PARA EL AGENTE ANTES DE CUALQUIER COMANDO.**

## 1. RESTRICCIONES DE HARDWARE (AWS t2.micro)

- **CONTENEDORES**: Siempre usar **Docker**. No correr procesos pesados nativos.
- **RAM**: 1GB (Saturada). No cargar mÃ¡s de 120-150 dÃ­as de datos 5m.
- **CPU**: 1 Core. **PROHIBIDO** usar `-j 2`. Siempre usar `-j 1`.
- **SWAP**: 4GB activos. Evitar procesos que lo saturen para no congelar la instancia (Load Average < 2.0 ideal).

## 2. REGLAS DE CONFIGURACIÃ“N (CRÃTICAS)

- **HARDWARE (t2.micro)**: Limitar a 3 pares para no colapsar la RAM.
- **SINTAXIS FUTURES**: En Binance Futures, los pares DEBEN usar el formato `PAR/USDT:USDT` (no `PAR/USDT`). Esto aplica para configs, whitelists y comandos.
- **RESOLUCIÃ“N DE CAZA (1m)**: El Hyperopt se ejecuta SIEMPRE a 1 minuto para detectar el gatillo en las Horas MÃ¡gicas. El refinado a 5m es solo para el despliegue final.
- **ESTRATEGIA ÃšNICA**: Solo `ChacalPulseV4_Hyperopt`.
- **SHORTS OBLIGATORIOS**: Siempre configurar `"can_short": true`.
- **ZOMBIES**: PROHIBIDO dejar contenedores con nombres aleatorios. El despliegue siempre debe ser vÃ­a `docker-compose_relevo.yml` para nombres fijos.

## 3. REGLAS DE ESTRATEGIA (CHACAL V4)

- **HORAS MÃGICAS**: Operar exclusivamente en las aperturas: Londres (08-10 UTC / 05-07 Local) y New York (13:30-17:30 UTC / 10:30-14:30 Local).
- **ADAPTACIÃ“N**: La estrategia DEBE diferenciar entre BULL, BEAR y LATERAL mediante indicadores (ADX/RSI).
- **HYPEROPT**: Optimizar parÃ¡metros de salida especÃ­ficos para cada uno de los 3 estados.

## 4. CICLO DE VIDA Y RECURSOS (CRÃTICO)

- **USO DE TIEMPO**:
  - **Horas MÃ¡gicas**: Trading activo (Caza).
  - **Horas Muertas**: Apagar trading y procesar **Hyperopts moneda por moneda** hasta hallar la configuraciÃ³n ganadora.
- **FINES DE SEMANA**: Reservados exclusivamente para **Pruebas y OptimizaciÃ³n**. NUNCA dejar bots corriendo a lo loco.
- **PERSISTENCIA**: No dejar procesos "viviendo" sin control. Si no hay estrategia ganadora validada, el bot NO OPERA.

## 5. PROCEDIMIENTO DE HYPEROPT (ESTÃNDAR DE ORO)

1. **MetodologÃ­a de Refinado (1m -> 5m)**:
   - **Fase 1 (PrecisiÃ³n)**: Uso de **Biblioteca QuirÃºrgica 1m**.
   - **Fase 2 (Refinado)**: Estabilidad en 5m. Para operar sin que nos maten las comiciones.
2. **Biblioteca QuirÃºrgica (1m Magic)**:
   - **SegmentaciÃ³n**: Solo se procesan velas de 1m correspondientes a las Horas MÃ¡gicas (+warmup).
   - **Capacidad Permanente**: Se mantendrÃ¡ un repositorio histÃ³rico de hasta **7 aÃ±os** en el directorio `binance_surgical`.
   - **Eficiencia**: 12 pares Ã— 6 horas/dÃ­a Ã— 1m â‰ˆ 6GB de disco para una dÃ©cada de datos tÃ¡cticos. Esto evita re-descargas y ahorra ancho de banda.
   - **Mantenimiento**: Cada fin de semana se "poda" la data nueva descargada para integrarla a la Biblioteca QuirÃºrgica.
3. **Fase 2: Refinamiento (5m - Industrial)**: âœ… **COMPLETADA 2026-02-08**
   - **Objetivo**: Validar robustez de parÃ¡metros con horizonte temporal extendido.
   - **Datos**: 365 dÃ­as @ 5m filtrada por **Horas MÃ¡gicas** (Londres + NY).
   - **Intensidad**: 1000 Ã©pocas por moneda.
   - **EjecuciÃ³n**: Secuencial (1 moneda por vez) para evitar OOM en t2.micro.
   - **Resultados Destacados**:
     - LINK: +196.35% (463 trades, 63.5% WR)
     - NEAR: +140.81% (292 trades, 76.0% WR)
     - SUI: +106.95% (268 trades, 70.1% WR)
     - DOGE: +105.29% (281 trades, 70.8% WR)
   - **Script**: `user_data/lanzar_fase2_final.sh`.
   - **LecciÃ³n Clave**: La combinaciÃ³n 1m (exploraciÃ³n) + 5m (validaciÃ³n) es superior a optimizar directamente en 5m.
4. **Pares (BatallÃ³n Elite - 12 Unidades)**:
   - **SelecciÃ³n**: BTC, ETH, SOL, XRP, ADA, DOT, DOGE, AVAX, LINK, BNB, SUI, NEAR.
   - **Criterio**: Monedas de Tier 1/2 con correlaciÃ³n real con BTC y volumen masivo para 1m. SUI y NEAR elegidas por su performance actual en el mercado.
5. **Cola de EjecuciÃ³n (Secuencial)**:
   - **Problema**: El Hyperopt de 12 monedas es inejecutable en 1GB de RAM de forma simultÃ¡nea.
   - **SoluciÃ³n**: Se usa el script `user_data/cola_hyperopt.sh` para procesar **una moneda por vez**.
   - **Persistencia**: Se lanza bajo `screen -dmS hyperopt_ELITE` para operar de forma autÃ³noma.
6. **Estructura de Datos (Biblioteca QuirÃºrgica)**:
   - **UbicaciÃ³n Nativa**: `user_data/data/binance/futures/`.
   - **Formato**: `feather` (mÃ¡xima velocidad de lectura).
   - **Injerto**: Para que Freqtrade reconozca los datos segmentados, deben residir en la ruta nativa y estar acompaÃ±ados de los archivos `funding_rate.feather` y `mark.feather` originales.

## 7. GESTIÃ“N DE INCIDENCIAS Y RESCATE (REGLAS DE HIERRO)

- **SATURACIÃ“N**: Si el Load Average > 10.0 o RAM < 50MB, realizar `sudo docker stop $(sudo docker ps -q)` inmediatamente.
- **SABOTAJE DE SHELL**: En PowerShell, los comandos remotos con expansiones `$(...)` deben enviarse entre comillas simples o dobles escapadas para evitar que se ejecuten localmente.
- **RESCATE FORENSE**: Si el servidor se cuelga, el archivo `.fthypt` es la Ãºnica fuente de verdad; usar `cat` para verificar integridad antes de intentar procesos pesados.
- **BACKUP PREVENTIVO**: Descargar el log (`SCP`) cada 4 monedas procesadas para no depender de la persistencia del servidor al final de la jornada.

## 8. GESTIÃ“N DE ENERGÃA Y SUPERVIVENCIA (FREE TIER) âœ…

- **ENCENDIDO (AWS Scheduler)**:
  - **Londres (04:55 AM ART)**: Regla `Chacal_PowerOn_Londres` (Cron: `55 7 ? * MON-FRI *`).
  - **NY (10:25 AM ART)**: Regla `Chacal_PowerOn_NY` (Cron: `25 13 ? * MON-FRI *`).
  - **Permisos**: IAM Role `ChacalPowerRole` con `AmazonEC2FullAccess`.
- **APAGADO (Vigilante)**:
  - Script `vigilante_energia.py` escaneando los 4 SQLite cada 5 min.
  - Horarios de check crÃ­ticos: **07:15 ART** y **14:45 ART**.
  - **LÃ³gica**: Si detecta trades abiertos o el archivo `/tmp/NO_APAGAR`, el apagado se **cancela**.
- **DESPLIEGUE MULTI-TORRE (t2.micro)**:
  - **Alpha**: BTC, ETH, SOL | **Beta**: BNB, XRP, ADA
  - **Gamma**: DOGE, AVAX, LINK | **Delta**: DOT, SUI, NEAR
  - Arranque automÃ¡tico vÃ­a `@reboot` en crontab llamando a `lanzar_torres.sh`.

## 9. ARQUITECTURA TÃ‰CNICA (MANUAL PARA IA/HUMANO) ðŸ“•

### LÃ³gica de Trading (ChacalPulseV4)

- **Gate Horario**: El bot calcula indicadores 24/7 pero solo abre la "reja" (`gate_open`) en ventanas de Londres y NY.
- **Modos**: `hunter` (solo ventanas) vs `vigilante` (siempre activo - opcional).
- **RegÃ­menes**: ADX/RSI detectan tendencia. El bot cambia Stoploss y ROI sobre la marcha (Bull/Bear/Lateral).

### Infraestructura (t2.micro - Relevo V4)

- **Torres Docker**: 4 contenedores (Alpha, Beta, Gamma, Delta) dividiendo 12 monedas por RAM.
- **Vigilante EnergÃ­a**: Script `vigilante_energia.py` escanea los 4 SQLite. El apagado se cancela si hay trades vivos.
- **Arranque**: `lanzar_torres.sh` se ejecuta `@reboot`.

---
**MisiÃ³n: Recuperar el capital con disciplina y precisiÃ³n.**
